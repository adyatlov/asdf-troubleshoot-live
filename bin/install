#!/usr/bin/env bash

# Constants
PACKAGE_NAME=$1
PACKAGE_VERSION=$2
INSTALL_PATH=$3

# Check if Go is installed
if ! command -v go >/dev/null; then
    echo "Error: Go is not installed. Please install Go before using this plugin."
    exit 1
fi

# Check Go version
GO_VERSION=$(go version | awk '{print $3}')
REQUIRED_GO_VERSION="go1.20"
if [[ "$GO_VERSION" < "$REQUIRED_GO_VERSION" ]]; then
    echo "Error: Go version $REQUIRED_GO_VERSION or newer is required. Current version: $GO_VERSION"
    exit 1
fi

# Download, build, and install your CLI tool
GOBIN="$INSTALL_PATH/bin" go install "github.com/mhrabovcin/troubleshoot-live@$PACKAGE_VERSION"

# Exit with success status
exit 0
